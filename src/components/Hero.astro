---
import site from "@content/site/global.json";
---

<header class="min-h-[100dvh] flex flex-col justify-center py-16">
    <h1
        class="text-4xl md:text-6xl mb-2 decrypt-text break-words hyphens-auto"
        data-original-text={site.siteName}
    >
        {site.siteName}
    </h1>
    <p>
        {site.siteDescription}
    </p>
    <p class="text-stone-500">{site.siteNameExplanation}</p>
    <div class="flex gap-3 md:gap-4 mt-4">
        <a
            href="#services"
            class="border border-stone-700 p-2 hover:bg-stone-800 rounded-3xl bg-stone-900 transition-colors"
        >
            <div class="bg-white text-black rounded-2xl px-4 py-3">
                Our Services
            </div>
        </a>
        <a
            href="#portfolio"
            class="p-2 px-4 inline-flex items-center hrounded-3xl underline decoration-[1px] underline-offset-[0.2em] hover:no-underline"
        >
            View Portfolio
        </a>
    </div>
</header>

<script>
    // Immediately hide the real text and show encrypted version to prevent flash
    document.addEventListener("astro:page-load", () => {
        const element = document.querySelector(".decrypt-text");
        if (element && !element.dataset.encrypted) {
            const originalText = element.textContent.trim();
            element.textContent = generateFixedEncryption(originalText);
            element.dataset.encrypted = "true";
        }
    });

    function generateFixedEncryption(text) {
        const chars = "0123456789abcdef";
        return text
            .split("")
            .map((char, index) => {
                if (char === " ") return " ";
                let seed = char.charCodeAt(0) * 31 + index * 17;
                return chars[seed % chars.length];
            })
            .join("");
    }

    class DecryptText {
        constructor(element) {
            this.element = element;
            this.originalText = element.dataset.originalText;
            this.chars = "0123456789abcdef";
            this.animationSpeed = 5;
            this.decryptSpeed = 40;
            this.encryptedText = this.generateFixedEncryption(
                this.originalText,
            );
            this.init();
        }

        init() {
            this.element.textContent = this.encryptedText;
            this.startDecryption();
        }

        generateFixedEncryption(text) {
            return generateFixedEncryption(text);
        }

        getRandomChar() {
            return this.chars[Math.floor(Math.random() * this.chars.length)];
        }

        startDecryption() {
            let currentText = this.element.textContent.split("");
            let decryptedCount = 0;

            const decrypt = () => {
                if (decryptedCount < this.originalText.length) {
                    // Decrypt one more character
                    if (this.originalText[decryptedCount] !== " ") {
                        currentText[decryptedCount] =
                            this.originalText[decryptedCount];
                        decryptedCount++;
                    } else {
                        decryptedCount++;
                    }

                    // Scramble remaining characters
                    for (let i = decryptedCount; i < currentText.length; i++) {
                        if (this.originalText[i] !== " ") {
                            currentText[i] = this.getRandomChar();
                        }
                    }

                    this.element.textContent = currentText.join("");
                    setTimeout(decrypt, this.decryptSpeed);
                } else {
                    // Animation complete - restore original font
                    this.element.style.fontFamily = "";
                    this.element.classList.remove("text-nowrap");
                }
            };

            // Start decryption after a brief pause
            setTimeout(decrypt, 500);
        }
    }

    // Initialize animation
    document.addEventListener("DOMContentLoaded", () => {
        const decryptElement = document.querySelector(".decrypt-text");
        if (decryptElement) {
            new DecryptText(decryptElement);
        }
    });

    // For Astro view transitions
    document.addEventListener("astro:page-load", () => {
        const decryptElement = document.querySelector(".decrypt-text");
        if (decryptElement && !decryptElement.dataset.animated) {
            new DecryptText(decryptElement);
            decryptElement.dataset.animated = "true";
        }
    });
</script>
